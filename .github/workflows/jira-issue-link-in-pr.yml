name: Link Jira issue key in PR
on:
  pull_request:
    types: [opened]
jobs:
  link_jira_issue: # 작업 이름
    runs-on: ubuntu-latest
    steps:
      - name: Find Jira Issue
        uses: cybervoid/gajira-get-issue@v1.1
        id: find
        with:
          input-text: ${{ github.head_ref }}
      - name: Update PR body with Jira link
        uses: AsasInnab/pr-body-action@v1
        if: steps.find.outputs.issue != ''
        with:
          body: |
            ## 📌 관련 이슈
            - Jira Ticket: [${{ steps.find.outputs.issue }}](https://depromeet05.atlassian.net/browse/${{ steps.find.outputs.issue }})

            ${{ github.event.pull_request.body }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Update PR body without Jira link
        uses: AsasInnab/pr-body-action@v1
        if: steps.find.outputs.issue == ''
        with:
          body: |
            ## 📌 관련 이슈
            <!-- Jira 이슈 번호가 브랜치 이름에서 감지되지 않았습니다 -->
            <!-- 수동으로 추가해주세요: - Jira Ticket: [NPP26-XXX](https://nota-dev.atlassian.net/browse/NPP02-XXX) -->
            ${{ github.event.pull_request.body }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
